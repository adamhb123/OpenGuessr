/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/photo-sphere-viewer@4.2.1/dist/plugins/markers.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
* Photo Sphere Viewer 4.2.1
* @copyright 2014-2015 Jérémy Heleine
* @copyright 2015-2021 Damien "Mistic" Sorel
* @licence MIT (https://opensource.org/licenses/MIT)
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("photo-sphere-viewer"),require("three")):"function"==typeof define&&define.amd?define(["photo-sphere-viewer","three"],i):((t="undefined"!=typeof globalThis?globalThis:t||self).PhotoSphereViewer=t.PhotoSphereViewer||{},t.PhotoSphereViewer.MarkersPlugin=i(t.PhotoSphereViewer,t.THREE))}(this,(function(t,i){"use strict";function e(){return(e=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t}).apply(this,arguments)}function s(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i}function r(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(i,e,s){var r=i[0],o=i[1],n=e[0],h=e[1],l=t.utils.greatArcDistance(i,e),a=Math.sin((1-s)*l)/Math.sin(l),p=Math.sin(s*l)/Math.sin(l),c=a*Math.cos(o)*Math.cos(r)+p*Math.cos(h)*Math.cos(n),u=a*Math.cos(o)*Math.sin(r)+p*Math.cos(h)*Math.sin(n),g=a*Math.sin(o)+p*Math.sin(h);return[Math.atan2(u,c),Math.atan2(g,Math.sqrt(c*c+u*u))]}var n={image:"image",html:"html",polygonPx:"polygonPx",polygonRad:"polygonRad",polylinePx:"polylinePx",polylineRad:"polylineRad",square:"square",rect:"rect",circle:"circle",ellipse:"ellipse",path:"path"},h=function(){function i(e,s){if(!e.id)throw new t.PSVError("missing marker id");this.psv=s,this.id=e.id,this.type=i.getType(e,!1),this.visible=!0,this.$el=null,this.config={},this.data=void 0,this.tooltip=null,this.props={inViewport:!1,dynamicSize:!1,anchor:null,position:null,position2D:null,positions3D:null,width:null,height:null,def:null},this.isNormal()?this.$el=document.createElement("div"):this.isPolygon()?this.$el=document.createElementNS(c.SVG_NS,"polygon"):this.isPolyline()?this.$el=document.createElementNS(c.SVG_NS,"polyline"):this.$el=document.createElementNS(c.SVG_NS,this.type),this.$el.id="psv-marker-"+this.id,this.$el[c.MARKER_DATA]=this,this.update(e)}var e=i.prototype;return e.destroy=function(){delete this.$el[c.MARKER_DATA],delete this.$el,delete this.config,delete this.props,delete this.psv},e.isNormal=function(){return this.type===n.image||this.type===n.html},e.isPoly=function(){return this.isPolygon()||this.isPolyline()},e.isPolyPx=function(){return this.type===n.polygonPx||this.type===n.polylinePx},e.isPolyRad=function(){return this.type===n.polygonRad||this.type===n.polylineRad},e.isPolygon=function(){return this.type===n.polygonPx||this.type===n.polygonRad},e.isPolyline=function(){return this.type===n.polylinePx||this.type===n.polylineRad},e.isSvg=function(){return this.type===n.square||this.type===n.rect||this.type===n.circle||this.type===n.ellipse||this.type===n.path},e.getScale=function(i){return Array.isArray(this.config.scale)?this.config.scale[0]+(this.config.scale[1]-this.config.scale[0])*t.CONSTANTS.EASINGS.inQuad(i/100):"function"==typeof this.config.scale?this.config.scale(i):"number"==typeof this.config.scale?this.config.scale*t.CONSTANTS.EASINGS.inQuad(i/100):1},e.getListContent=function(){return this.config.listContent?this.config.listContent:this.config.tooltip?this.config.tooltip.content:this.config.html?this.config.html:this.id},e.showTooltip=function(t){if(this.visible&&this.config.tooltip&&this.props.position2D){var i={content:this.config.tooltip.content,position:this.config.tooltip.position,data:this};if(this.isPoly()){var e=this.psv.container.getBoundingClientRect();i.box={width:2*this.psv.tooltip.size.arrow,height:2*this.psv.tooltip.size.arrow},t?(i.top=t.clientY-e.top-this.psv.tooltip.size.arrow/2,i.left=t.clientX-e.left-this.psv.tooltip.size.arrow):(i.top=this.props.position2D.y,i.left=this.props.position2D.x)}else i.top=this.props.position2D.y,i.left=this.props.position2D.x,i.box={width:this.props.width,height:this.props.height};this.tooltip?this.tooltip.move(i):this.tooltip=this.psv.tooltip.create(i)}},e.hideTooltip=function(){this.tooltip&&(this.tooltip.hide(),this.tooltip=null)},e.update=function(e){var s=i.getType(e,!0);if(void 0!==s&&s!==this.type)throw new t.PSVError("cannot change marker type");t.utils.deepmerge(this.config,e),this.data=this.config.data,this.visible=!1!==e.visible,this.isNormal()?this.$el.setAttribute("class","psv-marker psv-marker--normal"):this.$el.setAttribute("class","psv-marker psv-marker--svg"),this.config.className&&t.utils.addClasses(this.$el,this.config.className),this.config.tooltip&&(t.utils.addClasses(this.$el,"psv-marker--has-tooltip"),"string"==typeof this.config.tooltip&&(this.config.tooltip={content:this.config.tooltip})),this.config.content&&t.utils.addClasses(this.$el,"psv-marler--has-content"),this.config.style&&t.utils.deepmerge(this.$el.style,this.config.style),this.props.anchor=t.utils.parsePosition(this.config.anchor),this.isNormal()?this.__updateNormal():this.isPoly()?this.__updatePoly():this.__updateSvg()},e.__updateNormal=function(){if(!t.utils.isExtendedPosition(this.config))throw new t.PSVError("missing marker position, latitude/longitude or x/y");if(this.config.image&&(!this.config.width||!this.config.height))throw new t.PSVError("missing marker width/height");this.config.width&&this.config.height?(this.props.dynamicSize=!1,this.props.width=this.config.width,this.props.height=this.config.height,this.$el.style.width=this.config.width+"px",this.$el.style.height=this.config.height+"px"):this.props.dynamicSize=!0,this.config.image?(this.props.def=this.config.image,this.$el.style.backgroundImage="url("+this.config.image+")"):this.config.html&&(this.props.def=this.config.html,this.$el.innerHTML=this.config.html),this.$el.style.transformOrigin=100*this.props.anchor.x+"% "+100*this.props.anchor.y+"%",this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},e.__updateSvg=function(){var i=this;if(!t.utils.isExtendedPosition(this.config))throw new t.PSVError("missing marker position, latitude/longitude or x/y");switch(this.props.dynamicSize=!0,this.type){case n.square:this.props.def={x:0,y:0,width:this.config.square,height:this.config.square};break;case n.rect:Array.isArray(this.config.rect)?this.props.def={x:0,y:0,width:this.config.rect[0],height:this.config.rect[1]}:this.props.def={x:0,y:0,width:this.config.rect.width,height:this.config.rect.height};break;case n.circle:this.props.def={cx:this.config.circle,cy:this.config.circle,r:this.config.circle};break;case n.ellipse:Array.isArray(this.config.ellipse)?this.props.def={cx:this.config.ellipse[0],cy:this.config.ellipse[1],rx:this.config.ellipse[0],ry:this.config.ellipse[1]}:this.props.def={cx:this.config.ellipse.rx,cy:this.config.ellipse.ry,rx:this.config.ellipse.rx,ry:this.config.ellipse.ry};break;case n.path:this.props.def={d:this.config.path}}t.utils.each(this.props.def,(function(t,e){i.$el.setAttributeNS(null,e,t)})),this.config.svgStyle?t.utils.each(this.config.svgStyle,(function(e,s){i.$el.setAttributeNS(null,t.utils.dasherize(s),e)})):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.props.position=this.psv.dataHelper.cleanPosition(this.config),this.props.positions3D=[this.psv.dataHelper.sphericalCoordsToVector3(this.props.position)]},e.__updatePoly=function(){var i=this;this.props.dynamicSize=!0,this.config.svgStyle?(t.utils.each(this.config.svgStyle,(function(e,s){i.$el.setAttributeNS(null,t.utils.dasherize(s),e)})),this.isPolyline()&&!this.config.svgStyle.fill&&this.$el.setAttributeNS(null,"fill","none")):this.isPolygon()?this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"):this.isPolyline()&&(this.$el.setAttributeNS(null,"fill","none"),this.$el.setAttributeNS(null,"stroke","rgb(0,0,0)"));var e=this.config.polygonPx||this.config.polygonRad||this.config.polylinePx||this.config.polylineRad;if(!Array.isArray(e[0]))for(var s=0;s<e.length;s++)e.splice(s,2,[e[s],e[s+1]]);this.isPolyPx()?this.props.def=e.map((function(t){var e=i.psv.dataHelper.textureCoordsToSphericalCoords({x:t[0],y:t[1]});return[e.longitude,e.latitude]})):this.props.def=e.map((function(i){return[t.utils.parseAngle(i[0]),t.utils.parseAngle(i[1],!0)]}));var r=this.isPolygon()?function(i){for(var e=[i[0]],s=0,r=1;r<i.length;r++){var o=i[r-1][0]-i[r][0];o>Math.PI?s+=1:o<-Math.PI&&(s-=1),e.push([i[r][0]+2*s*Math.PI,i[r][1]])}var n=e.reduce((function(t,i){return[t[0]+i[0],t[1]+i[1]]}));return[t.utils.parseAngle(n[0]/i.length),n[1]/i.length]}(this.props.def):function(i){for(var e=0,s=[],r=0;r<i.length-1;r++){var n=t.utils.greatArcDistance(i[r],i[r+1])*t.CONSTANTS.SPHERE_RADIUS;s.push(n),e+=n}for(var h=0,l=0;l<i.length-1;l++){if(h+s[l]>e/2){var a=(e/2-h)/s[l];return o(i[l],i[l+1],a)}h+=s[l]}return i[Math.round(i.length/2)]}(this.props.def);this.props.position={longitude:r[0],latitude:r[1]},this.props.positions3D=this.props.def.map((function(t){return i.psv.dataHelper.sphericalCoordsToVector3({longitude:t[0],latitude:t[1]})}))},i.getType=function(i,e){void 0===e&&(e=!1);var s=[];if(t.utils.each(n,(function(t){t in i&&s.push(t)})),0===s.length&&!e)throw new t.PSVError("missing marker content, either "+Object.keys(n).join(", "));if(s.length>1)throw new t.PSVError("multiple marker content, either "+Object.keys(n).join(", "));return s[0]},i}(),l=function(t){function i(i){var e;return(e=t.call(this,i,"psv-button--hover-scale psv-markers-button",!0)||this).plugin=e.psv.getPlugin(c.id),e.plugin&&(e.plugin.on(c.EVENTS.SHOW_MARKERS,r(e)),e.plugin.on(c.EVENTS.HIDE_MARKERS,r(e)),e.toggleActive(!0)),e}s(i,t);var e=i.prototype;return e.destroy=function(){this.plugin&&(this.plugin.off(c.EVENTS.SHOW_MARKERS,this),this.plugin.off(c.EVENTS.HIDE_MARKERS,this)),t.prototype.destroy.call(this)},e.isSupported=function(){return!!this.plugin},e.handleEvent=function(t){switch(t.type){case c.EVENTS.SHOW_MARKERS:this.toggleActive(!0);break;case c.EVENTS.HIDE_MARKERS:this.toggleActive(!1)}},e.onClick=function(){this.plugin.prop.visible?this.plugin.hide():this.plugin.show()},i}(t.AbstractButton);l.id="markers",l.icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 9 81 81"><path fill="currentColor" d="M50.5 90S22.9 51.9 22.9 36.6 35.2 9 50.5 9s27.6 12.4 27.6 27.6S50.5 90 50.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n';var a='<svg xmlns="http://www.w3.org/2000/svg" viewBox="9 9 81 81"><path fill="currentColor" d="M37.5 90S9.9 51.9 9.9 36.6 22.2 9 37.5 9s27.6 12.4 27.6 27.6S37.5 90 37.5 90zm0-66.3c-6.1 0-11 4.9-11 11s4.9 11 11 11 11-4.9 11-11-4.9-11-11-11zM86.7 55H70c-1.8 0-3.3-1.5-3.3-3.3s1.5-3.3 3.3-3.3h16.7c1.8 0 3.3 1.5 3.3 3.3S88.5 55 86.7 55zm0-25h-15a3.3 3.3 0 0 1-3.3-3.3c0-1.8 1.5-3.3 3.3-3.3h15c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3zM56.5 73h30c1.8 0 3.3 1.5 3.3 3.3 0 1.8-1.5 3.3-3.3 3.3h-30a3.3 3.3 0 0 1-3.3-3.3 3.2 3.2 0 0 1 3.3-3.3z"/>\x3c!--Created by Rohith M S from the Noun Project--\x3e</svg>\n',p=function(i){function e(e){var s;return(s=i.call(this,e,"psv-button--hover-scale psv-markers-list-button",!0)||this).plugin=s.psv.getPlugin(c.id),s.plugin&&(s.psv.on(t.CONSTANTS.EVENTS.OPEN_PANEL,r(s)),s.psv.on(t.CONSTANTS.EVENTS.CLOSE_PANEL,r(s))),s.hide(),s}s(e,i);var o=e.prototype;return o.destroy=function(){this.psv.off(t.CONSTANTS.EVENTS.OPEN_PANEL,this),this.psv.off(t.CONSTANTS.EVENTS.CLOSE_PANEL,this),i.prototype.destroy.call(this)},o.isSupported=function(){return!!this.plugin},o.handleEvent=function(i){switch(i.type){case t.CONSTANTS.EVENTS.OPEN_PANEL:this.toggleActive(i.args[0]===c.ID_PANEL_MARKERS_LIST);break;case t.CONSTANTS.EVENTS.CLOSE_PANEL:this.toggleActive(!1)}},o.onClick=function(){this.plugin.toggleMarkersList()},e}(t.AbstractButton);p.id="markersList",p.icon=a,t.DEFAULTS.navbar.splice(t.DEFAULTS.navbar.indexOf("caption"),0,l.id,p.id),t.DEFAULTS.lang[l.id]="Markers",t.DEFAULTS.lang[p.id]="Markers list",t.registerButton(l),t.registerButton(p);var c=function(o){function n(i,s){var h;return(h=o.call(this,i)||this).container=document.createElement("div"),h.container.className="psv-markers",h.container.style.cursor=h.psv.config.mousemove?"move":"default",h.psv.container.appendChild(h.container),h.markers={},h.prop={visible:!0,currentMarker:null,hoveringMarker:null},h.config=e({clickEventOnMarker:!1},s),h.svgContainer=document.createElementNS(n.SVG_NS,"svg"),h.svgContainer.setAttribute("class","psv-markers-svg-container"),h.container.appendChild(h.svgContainer),h.container.addEventListener("mouseenter",r(h),!0),h.container.addEventListener("mouseleave",r(h),!0),h.container.addEventListener("mousemove",r(h),!0),h.container.addEventListener("contextmenu",r(h)),h.psv.on(t.CONSTANTS.EVENTS.CLICK,r(h)),h.psv.on(t.CONSTANTS.EVENTS.DOUBLE_CLICK,r(h)),h.psv.on(t.CONSTANTS.EVENTS.RENDER,r(h)),h.psv.on(t.CONSTANTS.EVENTS.CONFIG_CHANGED,r(h)),null!=s&&s.markers&&h.psv.once(t.CONSTANTS.EVENTS.READY,(function(){h.setMarkers(s.markers)})),h}s(n,o);var a=n.prototype;return a.destroy=function(){this.clearMarkers(!1),this.container.removeEventListener("mouseenter",this),this.container.removeEventListener("mouseleave",this),this.container.removeEventListener("mousemove",this),this.container.removeEventListener("contextmenu",this),this.psv.off(t.CONSTANTS.EVENTS.CLICK,this),this.psv.off(t.CONSTANTS.EVENTS.DOUBLE_CLICK,this),this.psv.off(t.CONSTANTS.EVENTS.RENDER,this),this.psv.off(t.CONSTANTS.EVENTS.CONFIG_CHANGED,this),this.psv.container.removeChild(this.container),delete this.svgContainer,delete this.markers,delete this.container,delete this.prop,o.prototype.destroy.call(this)},a.handleEvent=function(i){switch(i.type){case"mouseenter":this.__onMouseEnter(i);break;case"mouseleave":this.__onMouseLeave(i);break;case"mousemove":this.__onMouseMove(i);break;case"contextmenu":this.__onContextMenu(i);break;case t.CONSTANTS.EVENTS.CLICK:this.__onClick(i,i.args[0],!1);break;case t.CONSTANTS.EVENTS.DOUBLE_CLICK:this.__onClick(i,i.args[0],!0);break;case t.CONSTANTS.EVENTS.RENDER:this.renderMarkers();break;case t.CONSTANTS.EVENTS.CONFIG_CHANGED:this.container.style.cursor=this.psv.config.mousemove?"move":"default"}},a.show=function(){this.prop.visible=!0,this.renderMarkers(),this.trigger(n.EVENTS.SHOW_MARKERS)},a.hide=function(){this.prop.visible=!1,this.renderMarkers(),this.trigger(n.EVENTS.HIDE_MARKERS)},a.toggleAllTooltips=function(){this.prop.showAllTooltips=!this.prop.showAllTooltips,this.renderMarkers()},a.showAllTooltips=function(){this.prop.showAllTooltips=!0,this.renderMarkers()},a.hideAllTooltips=function(){this.prop.showAllTooltips=!1,this.renderMarkers()},a.getNbMarkers=function(){return Object.keys(this.markers).length},a.addMarker=function(i,e){if(void 0===e&&(e=!0),this.markers[i.id])throw new t.PSVError('marker "'+i.id+'" already exists');var s=new h(i,this.psv);return s.isNormal()?this.container.appendChild(s.$el):this.svgContainer.appendChild(s.$el),this.markers[s.id]=s,e&&(this.renderMarkers(),this.__refreshUi()),s},a.getMarker=function(i){var e="object"==typeof i?i.id:i;if(!this.markers[e])throw new t.PSVError('cannot find marker "'+e+'"');return this.markers[e]},a.getCurrentMarker=function(){return this.prop.currentMarker},a.updateMarker=function(t,i){void 0===i&&(i=!0);var e=this.getMarker(t.id);return e.update(t),i&&(this.renderMarkers(),this.__refreshUi()),e},a.removeMarker=function(t,i){void 0===i&&(i=!0);var e=this.getMarker(t);e.isNormal()?this.container.removeChild(e.$el):this.svgContainer.removeChild(e.$el),this.prop.hoveringMarker===e&&(this.prop.hoveringMarker=null),this.prop.currentMarker===e&&(this.prop.currentMarker=null),e.hideTooltip(),e.destroy(),delete this.markers[e.id],i&&this.__refreshUi()},a.setMarkers=function(i,e){var s=this;void 0===e&&(e=!0),this.clearMarkers(!1),t.utils.each(i,(function(t){return s.addMarker(t,!1)})),e&&(this.renderMarkers(),this.__refreshUi())},a.clearMarkers=function(i){var e=this;void 0===i&&(i=!0),t.utils.each(this.markers,(function(t){return e.removeMarker(t,!1)})),i&&(this.renderMarkers(),this.__refreshUi())},a.gotoMarker=function(t,i){var s=this,r=this.getMarker(t);return this.psv.animate(e({},r.props.position,{speed:i})).then((function(){s.trigger(n.EVENTS.GOTO_MARKER_DONE,r)}))},a.hideMarker=function(t){this.getMarker(t).visible=!1,this.renderMarkers()},a.showMarker=function(t){this.getMarker(t).visible=!0,this.renderMarkers()},a.toggleMarker=function(t){this.getMarker(t).visible^=!0,this.renderMarkers()},a.showMarkerPanel=function(t){var i,e=this.getMarker(t);null!=e&&null!=(i=e.config)&&i.content?this.psv.panel.show({id:n.ID_PANEL_MARKER,content:e.config.content}):this.psv.panel.hide(n.ID_PANEL_MARKER)},a.toggleMarkersList=function(){this.psv.panel.prop.contentId===n.ID_PANEL_MARKERS_LIST?this.hideMarkersList():this.showMarkersList()},a.showMarkersList=function(){var i=this,e=[];t.utils.each(this.markers,(function(t){t.visible&&!t.config.hideList&&e.push(t)})),e=this.change(n.EVENTS.RENDER_MARKERS_LIST,e),this.psv.panel.show({id:n.ID_PANEL_MARKERS_LIST,content:n.MARKERS_LIST_TEMPLATE(e,this.psv.config.lang.markers,t.utils.dasherize(n.MARKER_DATA)),noMargin:!0,clickHandler:function(e){var s=e.target?t.utils.getClosest(e.target,"li"):void 0,r=s?s.dataset[n.MARKER_DATA]:void 0;if(r){var o=i.getMarker(r);i.trigger(n.EVENTS.SELECT_MARKER_LIST,o),i.gotoMarker(o,1e3),i.hideMarkersList()}}})},a.hideMarkersList=function(){this.psv.panel.hide(n.ID_PANEL_MARKERS_LIST)},a.renderMarkers=function(){var i=this;t.utils.each(this.markers,(function(e){var s=i.prop.visible&&e.visible;if(s&&e.isPoly()){var r=i.__getPolyPositions(e);if(s=r.length>(e.isPolygon()?2:1)){var o=i.__getMarkerPosition(e);e.props.position2D=o;var n=r.map((function(t){return t.x-o.x+","+(t.y-o.y)})).join(" ");e.$el.setAttributeNS(null,"points",n),e.$el.setAttributeNS(null,"transform","translate("+o.x+" "+o.y+")")}}else if(s){e.props.dynamicSize&&i.__updateMarkerSize(e);var h=e.getScale(i.psv.getZoomLevel()),l=i.__getMarkerPosition(e,h);if(s=i.__isMarkerVisible(e,l))if(e.props.position2D=l,e.isSvg()){var a="translate("+l.x+", "+l.y+")";1!==h&&(a+=" scale("+h+", "+h+")"),e.$el.setAttributeNS(null,"transform",a)}else{var p="translate3D("+l.x+"px, "+l.y+"px, 0px)";1!==h&&(p+=" scale("+h+", "+h+")"),e.$el.style.transform=p}}e.props.inViewport=s,t.utils.toggleClass(e.$el,"psv-marker--visible",s),e.props.inViewport&&(i.prop.showAllTooltips||e===i.prop.hoveringMarker&&!e.isPoly())?e.showTooltip():e.props.inViewport&&e===i.prop.hoveringMarker||e.hideTooltip()}))},a.__isMarkerVisible=function(t,i){return t.props.positions3D[0].dot(this.psv.prop.direction)>0&&i.x+t.props.width>=0&&i.x-t.props.width<=this.psv.prop.size.width&&i.y+t.props.height>=0&&i.y-t.props.height<=this.psv.prop.size.height},a.__updateMarkerSize=function(i){var e;t.utils.addClasses(i.$el,"psv-marker--transparent"),i.isSvg()?(e=i.$el.getAttributeNS(null,"transform"),i.$el.removeAttributeNS(null,"transform")):(e=i.$el.style.transform,i.$el.style.transform="");var s=i.$el.getBoundingClientRect();i.props.width=s.width,i.props.height=s.height,t.utils.removeClasses(i.$el,"psv-marker--transparent"),e&&(i.isSvg()?i.$el.setAttributeNS(null,"transform",e):i.$el.style.transform=e),i.props.dynamicSize=!1},a.__getMarkerPosition=function(t,i){if(void 0===i&&(i=1),t.isPoly())return this.psv.dataHelper.vector3ToViewerCoords(this.psv.dataHelper.sphericalCoordsToVector3(t.props.position));var e=this.psv.dataHelper.vector3ToViewerCoords(t.props.positions3D[0]);return e.x-=t.props.width*t.props.anchor.x*i,e.y-=t.props.height*t.props.anchor.y*i,e},a.__getPolyPositions=function(t){var i=this,e=t.props.positions3D.length,s=t.props.positions3D.map((function(t){return{vector:t,visible:t.dot(i.psv.prop.direction)>0}})),r=[];return s.forEach((function(t,i){t.visible||[0===i?s[e-1]:s[i-1],i===e-1?s[0]:s[i+1]].forEach((function(e){e.visible&&r.push({visible:e,invisible:t,index:i})}))})),r.reverse().forEach((function(t){s.splice(t.index,0,{vector:i.__getPolyIntermediaryPoint(t.visible.vector,t.invisible.vector),visible:!0})})),s.filter((function(t){return t.visible})).map((function(t){return i.psv.dataHelper.vector3ToViewerCoords(t.vector)}))},a.__getPolyIntermediaryPoint=function(e,s){var r=this.psv.prop.direction.clone().normalize(),o=(new i.Vector3).crossVectors(e,s).normalize(),n=(new i.Vector3).crossVectors(o,e).normalize(),h=e.clone().multiplyScalar(-r.dot(n)),l=n.clone().multiplyScalar(r.dot(e)),a=(new i.Vector3).addVectors(h,l).normalize(),p=(new i.Vector3).crossVectors(a,r);return a.applyAxisAngle(p,.01).multiplyScalar(t.CONSTANTS.SPHERE_RADIUS)},a.__getTargetMarker=function(i,e){void 0===e&&(e=!1);var s=e?t.utils.getClosest(i,".psv-marker"):i;return s?s[n.MARKER_DATA]:void 0},a.__targetOnTooltip=function(i,e){return!(!i||!e)&&t.utils.hasParent(i,e.container)},a.__onMouseEnter=function(t){var i=this.__getTargetMarker(t.target);i&&!i.isPoly()&&(this.prop.hoveringMarker=i,this.trigger(n.EVENTS.OVER_MARKER,i),this.prop.showAllTooltips||i.showTooltip(t))},a.__onMouseLeave=function(t){var i=this.__getTargetMarker(t.target);!i||i.isPoly()&&this.__targetOnTooltip(t.relatedTarget,i.tooltip)||(this.trigger(n.EVENTS.LEAVE_MARKER,i),this.prop.hoveringMarker=null,this.prop.showAllTooltips||i.hideTooltip())},a.__onMouseMove=function(t){var i,e,s=this.__getTargetMarker(t.target);null!=s&&s.isPoly()?e=s:this.prop.hoveringMarker&&this.__targetOnTooltip(t.target,this.prop.hoveringMarker.tooltip)&&(e=this.prop.hoveringMarker),e?(this.prop.hoveringMarker||(this.trigger(n.EVENTS.OVER_MARKER,e),this.prop.hoveringMarker=e),this.prop.showAllTooltips||e.showTooltip(t)):null!=(i=this.prop.hoveringMarker)&&i.isPoly()&&(this.trigger(n.EVENTS.LEAVE_MARKER,this.prop.hoveringMarker),this.prop.showAllTooltips||this.prop.hoveringMarker.hideTooltip(),this.prop.hoveringMarker=null)},a.__onContextMenu=function(i){return!t.utils.getClosest(i.target,".psv-marker")||(i.preventDefault(),!1)},a.__onClick=function(t,i,e){var s=this.__getTargetMarker(i.target,!0);s?(this.prop.currentMarker=s,this.trigger(n.EVENTS.SELECT_MARKER,s,{dblclick:e,rightclick:i.rightclick}),this.config.clickEventOnMarker?i.marker=s:t.stopPropagation(),this.markers[s.id]&&this.showMarkerPanel(s.id)):this.prop.currentMarker&&(this.trigger(n.EVENTS.UNSELECT_MARKER,this.prop.currentMarker),this.psv.panel.hide(n.ID_PANEL_MARKER),this.prop.currentMarker=null)},a.__refreshUi=function(){var t=Object.values(this.markers).filter((function(t){return!t.config.hideList})).length,i=this.psv.navbar.getButton(l.id,!1),e=this.psv.navbar.getButton(p.id,!1);0===t?(null==i||i.hide(),null==e||e.hide(),(this.psv.panel.isVisible(n.ID_PANEL_MARKERS_LIST)||this.psv.panel.isVisible(n.ID_PANEL_MARKER))&&this.psv.panel.hide()):(null==i||i.show(),null==e||e.show(),this.psv.panel.isVisible(n.ID_PANEL_MARKERS_LIST)?this.showMarkersList():this.psv.panel.isVisible(n.ID_PANEL_MARKER)&&(this.prop.currentMarker?this.showMarkerPanel(this.prop.currentMarker):this.psv.panel.hide()))},n}(t.AbstractPlugin);return c.id="markers",c.EVENTS={GOTO_MARKER_DONE:"goto-marker-done",LEAVE_MARKER:"leave-marker",OVER_MARKER:"over-marker",RENDER_MARKERS_LIST:"render-markers-list",SELECT_MARKER:"select-marker",SELECT_MARKER_LIST:"select-marker-list",UNSELECT_MARKER:"unselect-marker",HIDE_MARKERS:"hide-markers",SHOW_MARKERS:"show-markers"},c.SVG_NS="http://www.w3.org/2000/svg",c.MARKER_DATA="psvMarker",c.ID_PANEL_MARKER="marker",c.ID_PANEL_MARKERS_LIST="markersList",c.MARKERS_LIST_TEMPLATE=function(t,i,e){return'\n<div class="psv-panel-menu psv-panel-menu--stripped">\n  <h1 class="psv-panel-menu-title">'+a+" "+i+'</h1>\n  <ul class="psv-panel-menu-list">\n    '+t.map((function(t){return"\n    <li data-"+e+'="'+t.config.id+'" class="psv-panel-menu-item">\n      '+("image"===t.type?'<span class="psv-panel-menu-item-icon" ><img src="'+t.config.image+'"/></span>':"")+'\n      <span class="psv-panel-menu-item-label">'+t.getListContent()+"</span>\n    </li>\n    "})).join("")+"\n  </ul>\n</div>\n"},c}));
//# sourceMappingURL=/sm/0a041b26ff84b4dd4c119b8d0441f403fbefcf79c15528b3c1331c75d16db4f2.map